<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=wuseman><link href=https://www.nr1.nu/linux/matomo/ rel=canonical><link rel="shortcut icon" href=../../img/favicon.ico><title>matomo - Nr1 (wuseman's wiki)</title><link href=../../css/bootstrap-3.3.7.min.css rel=stylesheet><link href=../../css/font-awesome.min.css rel=stylesheet><link href=../../css/base.css rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><link href=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css rel=stylesheet><link href=../../assets/pymdownx-extras/extra-e384f43f0f.css rel=stylesheet><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><script src=../../js/jquery-1.10.2.min.js defer></script><script src=../../js/bootstrap-3.3.7.min.js defer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script></head> <body> <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary"> <div class=container> <a class=navbar-brand href=../..>Nr1 (wuseman's wiki)</a> <!-- Expander button --> <button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-collapse> <span class=navbar-toggler-icon></span> </button> <!-- Expanded navigation --> <div id=navbar-collapse class="navbar-collapse collapse"> <!-- Main navigation --> <ul class="nav navbar-nav"> <li class=dropdown> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Home <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../.. class=dropdown-item>About</a> </li> <li> <a href=../../contact/ class=dropdown-item>Contact</a> </li> <li> <a href=../../cv/ class=dropdown-item>CV</a> </li> <li> <a href=../../usage_notes/ class=dropdown-item>Help</a> </li> </ul> </li> <li class=dropdown> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Android <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../android/ class=dropdown-item>info</a> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>adb</a> <ul class=dropdown-menu> <li> <a href=../../android/adb/readme/ class=dropdown-item>adb</a> </li> <li> <a href=../../android/adb/at/ class=dropdown-item>at-commands</a> </li> <li> <a href=../../android/adb/uusd_codes/ class=dropdown-item>uusd-codes</a> </li> </ul> </li> </ul> </li> <li class=dropdown> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Cracking <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../cracking/ class=dropdown-item>info</a> </li> <li> <a href=../../cracking/wloader/ class=dropdown-item>wloader</a> </li> </ul> </li> <li class=dropdown> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Gentoo <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../gentoo/gentoo-tools/ class=dropdown-item>gentoo-cheatsheet</a> </li> <li> <a href=../../gentoo/gentoo-chroot/ class=dropdown-item>gentoo-chroot</a> </li> <li> <a href=../../gentoo/gentoo-vmware/ class=dropdown-item>gentoo-vmware</a> </li> <li> <a href=../../gentoo/wuseman-overlay/ class=dropdown-item>wuseman-overlay</a> </li> <li> <a href=../../gentoo/gentoo-update/ class=dropdown-item>gentoo-wupdate</a> </li> </ul> </li> <li class=dropdown> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Hacking <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../hacking/ class=dropdown-item>hacking</a> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>Bios</a> <ul class=dropdown-menu> <li> <a href=../../hacking/bios/ class=dropdown-item>bios</a> </li> <li> <a href=../../hacking/bios/hp_device_and_bios-hacking/ class=dropdown-item>hp bios</a> </li> </ul> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>Bruteforce</a> <ul class=dropdown-menu> <li> <a href=../../hacking/bruteforce/ class=dropdown-item>bruteforce</a> </li> <li> <a href=../../hacking/bruteforce/EMAGNET/ class=dropdown-item>emagnet</a> </li> <li> <a href=../../hacking/bruteforce/wbruter/ class=dropdown-item>wbruter</a> </li> <li> <a href=../../hacking/bruteforce/wssh/ class=dropdown-item>wssh</a> </li> <li> <a href=../../hacking/bruteforce/swedish_wordlist.txt/ class=dropdown-item>swedish wordlist</a> </li> </ul> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>Cameras</a> <ul class=dropdown-menu> <li> <a href=../../hacking/cameras/ class=dropdown-item>cameras</a> </li> <li> <a href=../../hacking/cameras/biltemas_babycam/ class=dropdown-item>biltemas babycam</a> </li> <li> <a href=../../hacking/cameras/dlink-6100lh/ class=dropdown-item>dlink-6100lh</a> </li> </ul> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>Chromebook</a> <ul class=dropdown-menu> <li> <a href=../../hacking/chromebook/ class=dropdown-item>chromebook</a> </li> <li> <a href=../../hacking/chromebook/acer_chromebook_c720/ class=dropdown-item>acer c720</a> </li> <li> <a href=../../hacking/chromebook/acer_chromebook_c740/ class=dropdown-item>acer c740</a> </li> </ul> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>Radio</a> <ul class=dropdown-menu> <li> <a href=../../hacking/radio/ class=dropdown-item>radio</a> </li> <li> <a href=../../hacking/radio/boose_soundtouch/ class=dropdown-item>boose soundtouch</a> </li> </ul> </li> <li class=dropdown-submenu> <a href=# class=dropdown-item>Router</a> <ul class=dropdown-menu> <li> <a href=../../hacking/routers/ class=dropdown-item>router</a> </li> <li> <a href=../../hacking/routers/technicolor_dga4330ts/ class=dropdown-item>technicolor dga4330ts</a> </li> </ul> </li> </ul> </li> <li class="dropdown active"> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Linux <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../apt/ class=dropdown-item>apt</a> </li> <li> <a href=../awk/ class=dropdown-item>awk</a> </li> <li> <a href=../chroot/ class=dropdown-item>chroot</a> </li> <li> <a href=../cryptsetup/ class=dropdown-item>cryptsetup</a> </li> <li> <a href=../curl/ class=dropdown-item>curl</a> </li> <li> <a href=../dev_and_proc/ class=dropdown-item>dev and proc</a> </li> <li> <a href=../exiftool/ class=dropdown-item>exiftool</a> </li> <li> <a href=../find/ class=dropdown-item>find</a> </li> <li> <a href=../git/ class=dropdown-item>git</a> </li> <li> <a href=../gnupg/ class=dropdown-item>gnupg</a> </li> <li> <a href=../grep/ class=dropdown-item>grep</a> </li> <li> <a href=../kernel/ class=dropdown-item>kernel</a> </li> <li> <a href=../log/ class=dropdown-item>log</a> </li> <li> <a href=./ class="dropdown-item active">matomo</a> </li> <li> <a href=../merge-tricks/ class=dropdown-item>merge tricks</a> </li> <li> <a href=../nmap/ class=dropdown-item>nmap</a> </li> <li> <a href=../netstat/ class=dropdown-item>netstat</a> </li> <li> <a href=../perf/ class=dropdown-item>perf</a> </li> <li> <a href=../rename/ class=dropdown-item>rename</a> </li> <li> <a href=../rg/ class=dropdown-item>ripgrep</a> </li> <li> <a href=../sed/ class=dropdown-item>sed</a> </li> <li> <a href=../ssh-log/ class=dropdown-item>ssh-log</a> </li> <li> <a href=../syslog-ng/syslog-conf.ng/ class=dropdown-item>syslog-ng</a> </li> <li> <a href=../sys/ class=dropdown-item>sys</a> </li> <li> <a href=../sqlmap/ class=dropdown-item>sqlmap</a> </li> <li> <a href=../tcpdump/ class=dropdown-item>tcpdump</a> </li> <li> <a href=../whatismyip/ class=dropdown-item>whatismyip</a> </li> <li> <a href=../wireguard/ class=dropdown-item>wireguard</a> </li> <li> <a href=../vim/ class=dropdown-item>vim</a> </li> </ul> </li> <li class=dropdown> <a href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Misc <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../archive/useragents/user_agents.txt class=dropdown-item>UserAgents</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav ml-auto"> <li class=nav-item> <a href=# class=nav-link data-toggle=modal data-target=#mkdocs_search_modal> <i class="fa fa-search"></i> Search </a> </li> <li class=nav-item> <a rel=prev href=../log/ class=nav-link> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li class=nav-item> <a rel=next href=../merge-tricks/ class=nav-link> Next <i class="fa fa-arrow-right"></i> </a> </li> <li class=nav-item> <a href=https://github.com/www.nr1.nu/tree/master/docs/src/markdown/linux/matomo.md class=nav-link>Edit on www.nr1.nu</a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role=complementary> <div class=navbar-header> <button type=button class="navbar-toggler collapsed" data-toggle=collapse data-target=#toc-collapse title="Table of Contents"> <span class="fa fa-angle-down"></span> </button> </div> <div id=toc-collapse class="navbar-collapse collapse card bg-secondary"> <ul class="nav flex-column"> <li class=nav-item data-level=1><a href=#matomo class=nav-link>matomo</a> <ul class="nav flex-column"> </ul> </li> <li class=nav-item data-level=1><a href=#step-3-create-apache-or-nginx-configuration-file class=nav-link>Step 3: Create Apache or Nginx Configuration File</a> <ul class="nav flex-column"> </ul> </li> <li class=nav-item data-level=1><a href=#nginx class=nav-link>Nginx</a> <ul class="nav flex-column"> <li class=nav-item data-level=2><a href=#enable-https class=nav-link>Enable HTTPS</a> <ul class="nav flex-column"> </ul> </li> </ul> </li> </ul> </div> </div></div> <div class=col-md-9 role=main> <h1 id=matomo>matomo<a class=headerlink href=#matomo title="Permanent link"></a></h1> <h3 id=download-matomo>Download Matomo<a class=headerlink href=#download-matomo title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>wget https://builds.matomo.org/matomo-latest.zip
</code></pre></div> <h3 id=once-downloaded-extract-the-archive-with-unzip>Once downloaded, extract the archive with unzip.<a class=headerlink href=#once-downloaded-extract-the-archive-with-unzip title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>mkdir -p /var/www/html/site/
wget https://builds.matomo.org/matomo-latest.zip
unzip matomo-latest.zip -d /var/www/html/site
</code></pre></div> <p>The <code>-d</code> option specifies the target directory. Matomo web files will be extracted to /var/www/matomo/. Then we need to change the owner of this directory to www-data so that the web server can write to this directory.</p> <div class=highlight><pre><span></span><code>chown www-data:www-data /var/www/html/site -R
</code></pre></div> <h3 id=create-a-database-and-user-in-mariadb>Create a Database and User in MariaDB<a class=headerlink href=#create-a-database-and-user-in-mariadb title="Permanent link"></a></h3> <p>Log into MariaDB database server with the following command.</p> <div class=highlight><pre><span></span><code>mysql
</code></pre></div> <h3 id=alternatively-you-can-also-use-this-command-to-login>Alternatively, you can also use this command to login.<a class=headerlink href=#alternatively-you-can-also-use-this-command-to-login title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>mysql
</code></pre></div> <h3 id=then-create-a-database-for-matomo-this-tutorial-name-the-database-matomo-you-can-use-whatever-name-you-like>Then create a database for Matomo. This tutorial name the database matomo. You can use whatever name you like.<a class=headerlink href=#then-create-a-database-for-matomo-this-tutorial-name-the-database-matomo-you-can-use-whatever-name-you-like title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>create database matomo<span class=p>;</span>
</code></pre></div> <h3 id=create-the-database-user-again-you-can-use-your-preferred-name-for-this-user>Create the database user. Again, you can use your preferred name for this user.<a class=headerlink href=#create-the-database-user-again-you-can-use-your-preferred-name-for-this-user title="Permanent link"></a></h3> <h3 id=replace-your-password-with-your-preferred-password>Replace your-password with your preferred password.<a class=headerlink href=#replace-your-password-with-your-preferred-password title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>create user wuseman@localhost identified by <span class=s1>&#39;password&#39;</span><span class=p>;</span>
</code></pre></div> <h3 id=grant-this-user-all-privileges-on-the-matomo-database>Grant this user all privileges on the matomo database.<a class=headerlink href=#grant-this-user-all-privileges-on-the-matomo-database title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>grant all privileges on matomo.* to wuseman@localhost<span class=p>;</span>
</code></pre></div> <h3 id=flush-privileges-and-exit>Flush privileges and exit.<a class=headerlink href=#flush-privileges-and-exit title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>flush privileges<span class=p>;</span>
exit<span class=p>;</span>
</code></pre></div> <h1 id=step-3-create-apache-or-nginx-configuration-file>Step 3: Create Apache or Nginx Configuration File<a class=headerlink href=#step-3-create-apache-or-nginx-configuration-file title="Permanent link"></a></h1> <h3 id=if-you-prefer-to-use-apache-web-server-then-create-a-virtual-host-configuration-file-in-etcapache2sites-available-directory>If you prefer to use Apache web server, then create a virtual host configuration file in /etc/apache2/sites-available/ directory.<a class=headerlink href=#if-you-prefer-to-use-apache-web-server-then-create-a-virtual-host-configuration-file-in-etcapache2sites-available-directory title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>vim /etc/apache2/sites-available/matomo.conf
</code></pre></div> <h3 id=put-the-following-text-into-the-file>Put the following text into the file.<a class=headerlink href=#put-the-following-text-into-the-file title="Permanent link"></a></h3> <h3 id=replace-wnr1nu-with-your-own-domain-name-dont-forget-to-set-a-record-for-the-domain-name-in-your-dns-manager>Replace w.nr1.nu with your own domain name. Don’t forget to set A record for the domain name in your DNS manager.<a class=headerlink href=#replace-wnr1nu-with-your-own-domain-name-dont-forget-to-set-a-record-for-the-domain-name-in-your-dns-manager title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>&lt;VirtualHost *:80&gt;
        ServerAdmin webmaster@localhost
        ServerName w.nr1.nu
        DocumentRoot /var/www/matomo/

        &lt;Directory /var/www/matomo&gt;
           DirectoryIndex index.php
           Options FollowSymLinks
           AllowOverride All
           Require all granted
        &lt;/Directory&gt;

        &lt;Files <span class=s2>&quot;console&quot;</span>&gt;
           Options None
           Require all denied
        &lt;/Files&gt;

        &lt;Directory /var/www/matomo/misc/user&gt;
           Options None
           Require all granted
        &lt;/Directory&gt;

        &lt;Directory /var/www/matomo/misc&gt;
           Options None
           Require all denied
        &lt;/Directory&gt;

        &lt;Directory /var/www/matomo/vendor&gt;
           Options None
           Require all denied
        &lt;/Directory&gt;

        ErrorLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/matomo_error.log
        CustomLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/matomo_access.log combined

&lt;/VirtualHost&gt;
</code></pre></div> <h3 id=save-and-close-the-file-then-enable-this-virtual-host>Save and close the file. Then enable this virtual host.<a class=headerlink href=#save-and-close-the-file-then-enable-this-virtual-host title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>a2ensite matomo.conf
</code></pre></div> <h3 id=reload-apache-web-server-for-the-change-to-take-effect>Reload Apache web server for the change to take effect.<a class=headerlink href=#reload-apache-web-server-for-the-change-to-take-effect title="Permanent link"></a></h3> <ul> <li>OpenRC</li> </ul> <div class=highlight><pre><span></span><code>/etc/init.d/apache2 
</code></pre></div> <ul> <li>Systemd</li> </ul> <div class=highlight><pre><span></span><code>systemctl reload apache2
</code></pre></div> <h1 id=nginx>Nginx<a class=headerlink href=#nginx title="Permanent link"></a></h1> <h3 id=if-you-prefer-to-use-nginx-web-server-then-create-a-matomoconf-file-in-etcnginxconfd-directory>If you prefer to use Nginx web server, then create a matomo.conf file in /etc/nginx/conf.d/ directory.<a class=headerlink href=#if-you-prefer-to-use-nginx-web-server-then-create-a-matomoconf-file-in-etcnginxconfd-directory title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>vim /etc/nginx/conf.d/matomo.conf
</code></pre></div> <h3 id=put-the-following-text-into-the-file-replace-wnr1nu-with-your-own-domain-name>Put the following text into the file. Replace w.nr1.nu with your own domain name.<a class=headerlink href=#put-the-following-text-into-the-file-replace-wnr1nu-with-your-own-domain-name title="Permanent link"></a></h3> <h3 id=dont-forget-to-set-a-record-for-the-domain-name-in-your-dns-manager>Don’t forget to set A record for the domain name in your DNS manager.<a class=headerlink href=#dont-forget-to-set-a-record-for-the-domain-name-in-your-dns-manager title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>server <span class=o>{</span>
    listen <span class=o>[</span>::<span class=o>]</span>:80<span class=p>;</span>
    listen <span class=m>80</span><span class=p>;</span>
    server_name w.nr1.nu<span class=p>;</span>

    access_log /var/log/nginx/matomo.access.log<span class=p>;</span>
    error_log /var/log/nginx/matomo.error.log<span class=p>;</span>

    root /var/www/matomo/<span class=p>;</span> 
    
    index index.php<span class=p>;</span>
        
    <span class=c1>## only allow accessing the following php files</span>
    location ~ ^/<span class=o>(</span>index<span class=p>|</span>matomo<span class=p>|</span>piwik<span class=p>|</span>js/index<span class=o>)</span>.php <span class=o>{</span>
        include snippets/fastcgi-php.conf<span class=p>;</span>
        fastcgi_param HTTP_PROXY <span class=s2>&quot;&quot;</span><span class=p>;</span> <span class=c1># prohibit httpoxy: https://httpoxy.org/</span>
        fastcgi_pass unix:/run/php/php7.4-fpm.sock<span class=p>;</span> 
    <span class=o>}</span>
    
    <span class=c1>## needed for HeatmapSessionRecording plugin</span>
    <span class=nv>location</span> <span class=o>=</span> /plugins/HeatmapSessionRecording/configs.php <span class=o>{</span> 
        include snippets/fastcgi-php.conf<span class=p>;</span>
        fastcgi_param HTTP_PROXY <span class=s2>&quot;&quot;</span><span class=p>;</span>
        fastcgi_pass unix:/run/php/php7.4-fpm.sock<span class=p>;</span> 
    <span class=o>}</span>
    
    <span class=c1>## deny access to all other .php files</span>
    location ~* ^.+<span class=se>\.</span>php$ <span class=o>{</span>
        deny all<span class=p>;</span>
        <span class=k>return</span> <span class=m>403</span><span class=p>;</span>
    <span class=o>}</span>

    <span class=c1>## serve all other files normally </span>
    location / <span class=o>{</span>
        try_files <span class=nv>$uri</span> <span class=nv>$uri</span>/ <span class=o>=</span><span class=m>404</span><span class=p>;</span>
    <span class=o>}</span>
    
    <span class=c1>## disable all access to the following directories </span>
    location ~ /<span class=o>(</span>config<span class=p>|</span>tmp<span class=p>|</span>core<span class=p>|</span>lang<span class=o>)</span> <span class=o>{</span>
        deny all<span class=p>;</span>
        <span class=k>return</span> <span class=m>403</span><span class=p>;</span> <span class=c1># replace with 404 to not show these directories exist</span>
    <span class=o>}</span>
    location ~ /<span class=se>\.</span>ht <span class=o>{</span>
        deny  all<span class=p>;</span>
        <span class=k>return</span> <span class=m>403</span><span class=p>;</span>
    <span class=o>}</span>

    location ~ <span class=se>\.</span><span class=o>(</span>gif<span class=p>|</span>ico<span class=p>|</span>jpg<span class=p>|</span>png<span class=p>|</span>svg<span class=p>|</span>js<span class=p>|</span>css<span class=p>|</span>htm<span class=p>|</span>html<span class=p>|</span>mp3<span class=p>|</span>mp4<span class=p>|</span>wav<span class=p>|</span>ogg<span class=p>|</span>avi<span class=p>|</span>ttf<span class=p>|</span>eot<span class=p>|</span>woff<span class=p>|</span>woff2<span class=p>|</span>json<span class=o>)</span>$ <span class=o>{</span>
        allow all<span class=p>;</span>
        <span class=c1>## Cache images,CSS,JS and webfonts for an hour</span>
        <span class=c1>## Increasing the duration may improve the load-time, but may cause old files to show after an Matomo upgrade</span>
        expires 1h<span class=p>;</span>
        add_header Pragma public<span class=p>;</span>
        add_header Cache-Control <span class=s2>&quot;public&quot;</span><span class=p>;</span>
    <span class=o>}</span>

    location ~ /<span class=o>(</span>libs<span class=p>|</span>vendor<span class=p>|</span>plugins<span class=p>|</span>misc/user<span class=o>)</span> <span class=o>{</span>
        deny all<span class=p>;</span>
        <span class=k>return</span> <span class=m>403</span><span class=p>;</span>
    <span class=o>}</span>

    <span class=c1>## properly display textfiles in root directory</span>
    location ~/<span class=o>(</span>.*<span class=se>\.</span>md<span class=p>|</span>LEGALNOTICE<span class=p>|</span>LICENSE<span class=o>)</span> <span class=o>{</span>
        default_type text/plain<span class=p>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div> <h3 id=save-and-close-the-file-test-nginx-configuration-then-reload-nginx-for-the-changes-to-take-effect>Save and close the file. Test Nginx configuration, then reload Nginx for the changes to take effect.<a class=headerlink href=#save-and-close-the-file-test-nginx-configuration-then-reload-nginx-for-the-changes-to-take-effect title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>nginx -t
</code></pre></div> <h3 id=install-php-modules-required-or-recommended-by-matomo>Install PHP modules required or recommended by Matomo.<a class=headerlink href=#install-php-modules-required-or-recommended-by-matomo title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>apt install php-imagick php7.4-mysql php7.4-fpm php7.4-common php7.4-gd php7.4-json php7.4-curl  php7.4-zip php7.4-xml php7.4-mbstring php7.4-bz2 php7.4-intl
</code></pre></div> <h3 id=if-you-are-using-apache-web-server-you-need-to-reload-it-to-make-it-run-with-these-php-modules>If you are using Apache web server, you need to reload it to make it run with these PHP modules.<a class=headerlink href=#if-you-are-using-apache-web-server-you-need-to-reload-it-to-make-it-run-with-these-php-modules title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>systemctl reload apache2
</code></pre></div> <p>Nginx users don’t need to reload. Now you should be able to visit the Matomo web-based install wizard at <code>http://w.nr1.nu</code>, but before entering any information, let’s enable HTTPS.</p> <h2 id=enable-https>Enable HTTPS<a class=headerlink href=#enable-https title="Permanent link"></a></h2> <p>To encrypt the HTTP traffic when you visit the Matomo web interface, we can enable HTTPS by installing a free TLS certificate issued from Let’s Encrypt. Run the following commands to install Let’s Encrypt client (certbot) on Ubuntu 20.04.</p> <div class=highlight><pre><span></span><code>apt update
apt install certbot
</code></pre></div> <h3 id=if-you-use-nginx-you-also-need-to-install-the-certbot-nginx-plugin>If you use Nginx, you also need to install the Certbot Nginx plugin.<a class=headerlink href=#if-you-use-nginx-you-also-need-to-install-the-certbot-nginx-plugin title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>apt install python3-certbot-nginx
</code></pre></div> <h3 id=then-run-the-following-command-to-obtain-and-install-tls-certificate>Then run the following command to obtain and install TLS certificate.<a class=headerlink href=#then-run-the-following-command-to-obtain-and-install-tls-certificate title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>certbot --nginx --agree-tos --redirect --hsts --staple-ocsp --email wuseman@nr1.nu -d w.nr1.nu
</code></pre></div> <h3 id=if-you-use-apache-you-also-need-to-install-the-certbot-apache-plugin>If you use Apache, you also need to install the Certbot Apache plugin.<a class=headerlink href=#if-you-use-apache-you-also-need-to-install-the-certbot-apache-plugin title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>emerge app-crypt/certbot-apache
apt install python3-certbot-apache
</code></pre></div> <h3 id=then-run-this-command-to-obtain-and-install-tls-certificate>Then run this command to obtain and install TLS certificate.<a class=headerlink href=#then-run-this-command-to-obtain-and-install-tls-certificate title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>certbot --apache --agree-tos --redirect --hsts --staple-ocsp --email you@example.com -d w.nr1.nu
</code></pre></div> <h3 id=step-6-finish-the-installation-in-your-web-browser>Step 6: Finish the Installation in your Web Browser<a class=headerlink href=#step-6-finish-the-installation-in-your-web-browser title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code><span class=o>[</span>visit http://localhost/matomo/<span class=o>](</span>https://w.nr1.nu<span class=o>)</span>
</code></pre></div> <h3 id=permissions-problem>Permissions problem<a class=headerlink href=#permissions-problem title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>chown -R wuseman:wuseman /var/www/html/
find /var/www/html/ -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/ -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/assets/ -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/assets/ -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/cache/ -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/cache/ -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/logs/ -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/logs/ -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/tcpdf/ -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/tcpdf/ -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/templates_c -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
find /var/www/html/templates_c -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span>
</code></pre></div> <h3 id=install-by-copy-and-paste>Install By Copy And Paste<a class=headerlink href=#install-by-copy-and-paste title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code>mysql -e <span class=s2>&quot;drop datababse matomo&quot;</span>
mysql -e <span class=s2>&quot;create database matomo;&quot;</span>
mysql -e <span class=s2>&quot;create user wuseman@localhost identified by &#39;odemnn&#39;;&quot;</span>
mysql -e <span class=s2>&quot;grant all privileges on matomo.* to wuseman@localhost;&quot;</span>
mysql -e <span class=s2>&quot;flush privileges;&quot;</span>
wget https://builds.matomo.org/matomo-latest.zip
unzip matomo-latest.zip -d /var/www/html/site
chown wuseman:wuseman /var/www/html/site -R
google-chrome-stable http://localhost/matomo
</code></pre></div> <h3 id=add-below-js-script-inside-header-on-your-website-edit-the-setsiteid-if-needed>Add below JS script inside header on your website, edit the setSiteId if needed<a class=headerlink href=#add-below-js-script-inside-header-on-your-website-edit-the-setsiteid-if-needed title="Permanent link"></a></h3> <div class=highlight><pre><span></span><code><span class=c>&lt;!--</span><span class=w> </span><span class=nx>Matomo</span><span class=w> </span><span class=o>--&gt;</span><span class=w></span>
<span class=o>&lt;</span><span class=nx>script</span><span class=o>&gt;</span><span class=w></span>
<span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=nx>_paq</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>window</span><span class=p>.</span><span class=nx>_paq</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>window</span><span class=p>.</span><span class=nx>_paq</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>[];</span><span class=w></span>
<span class=w>  </span><span class=cm>/* tracker methods like &quot;setCustomDimension&quot; should be called before &quot;trackPageView&quot; */</span><span class=w></span>
<span class=w>  </span><span class=nx>_paq</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=s1>&#39;trackPageView&#39;</span><span class=p>]);</span><span class=w></span>
<span class=w>  </span><span class=nx>_paq</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=s1>&#39;enableLinkTracking&#39;</span><span class=p>]);</span><span class=w></span>
<span class=w>  </span><span class=p>(</span><span class=kd>function</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>u</span><span class=o>=</span><span class=s2>&quot;//w.nr1.nu/&quot;</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=nx>_paq</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=s1>&#39;setTrackerUrl&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>u</span><span class=o>+</span><span class=s1>&#39;matomo.php&#39;</span><span class=p>]);</span><span class=w></span>
<span class=w>    </span><span class=nx>_paq</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=s1>&#39;setSiteId&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>]);</span><span class=w></span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>d</span><span class=o>=</span><span class=nb>document</span><span class=p>,</span><span class=w> </span><span class=nx>g</span><span class=o>=</span><span class=nx>d</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;script&#39;</span><span class=p>),</span><span class=w> </span><span class=nx>s</span><span class=o>=</span><span class=nx>d</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s1>&#39;script&#39;</span><span class=p>)[</span><span class=mf>0</span><span class=p>];</span><span class=w></span>
<span class=w>    </span><span class=nx>g</span><span class=p>.</span><span class=k>async</span><span class=o>=</span><span class=kc>true</span><span class=p>;</span><span class=w> </span><span class=nx>g</span><span class=p>.</span><span class=nx>src</span><span class=o>=</span><span class=nx>u</span><span class=o>+</span><span class=s1>&#39;matomo.js&#39;</span><span class=p>;</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>parentNode</span><span class=p>.</span><span class=nx>insertBefore</span><span class=p>(</span><span class=nx>g</span><span class=p>,</span><span class=nx>s</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>})();</span><span class=w></span>
<span class=o>&lt;</span><span class=err>/script&gt;</span><span class=w></span>
<span class=c>&lt;!--</span><span class=w> </span><span class=nx>End</span><span class=w> </span><span class=nx>Matomo</span><span class=w> </span><span class=nx>Code</span><span class=w> </span><span class=o>--&gt;</span><span class=w></span>
</code></pre></div> <h3 id=end>End!<a class=headerlink href=#end title="Permanent link"></a></h3></div> </div> </div> <footer class=col-md-12> <hr> <p>Copyright &copy; 2015 - 2022 <a href=https://github.com/wuseman target=_blank rel=noopener>wuseman</a> </p> <p>Documentation built with <a href=https://www.mkdocs.org/ >MkDocs</a>.</p> </footer> <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script> <script src=../../js/base.js defer></script> <script src=https://unpkg.com/mermaid@8.13.3/dist/mermaid.min.js defer></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js defer></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js defer></script> <script src=../../assets/pymdownx-extras/extra-loader-5bb526e4.js defer></script> <script src=../../search/main.js defer></script> <div class=modal id=mkdocs_search_modal tabindex=-1 role=dialog aria-labelledby=searchModalLabel aria-hidden=true> <div class="modal-dialog modal-lg"> <div class=modal-content> <div class=modal-header> <h4 class=modal-title id=searchModalLabel>Search</h4> <button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button> </div> <div class=modal-body> <p>From here you can search these documents. Enter your search terms below.</p> <form> <div class=form-group> <input type=search class=form-control placeholder=Search... id=mkdocs-search-query title="Type search term here"> </div> </form> <div id=mkdocs-search-results data-no-results-text="No results found"></div> </div> <div class=modal-footer> </div> </div> </div> </div><div class=modal id=mkdocs_keyboard_modal tabindex=-1 role=dialog aria-labelledby=keyboardModalLabel aria-hidden=true> <div class=modal-dialog> <div class=modal-content> <div class=modal-header> <h4 class=modal-title id=keyboardModalLabel>Keyboard Shortcuts</h4> <button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button> </div> <div class=modal-body> <table class=table> <thead> <tr> <th style="width: 20%;">Keys</th> <th>Action</th> </tr> </thead> <tbody> <tr> <td class="help shortcut"><kbd>?</kbd></td> <td>Open this help</td> </tr> <tr> <td class="next shortcut"><kbd>n</kbd></td> <td>Next page</td> </tr> <tr> <td class="prev shortcut"><kbd>p</kbd></td> <td>Previous page</td> </tr> <tr> <td class="search shortcut"><kbd>s</kbd></td> <td>Search</td> </tr> </tbody> </table> </div> <div class=modal-footer> </div> </div> </div> </div> </body> </html> 